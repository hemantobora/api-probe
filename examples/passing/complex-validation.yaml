# Complex validation test - demonstrates advanced validation patterns
tests:
  # Test 1: Complex nested JSON validation
  - name: "Nested JSON Validation"
    type: rest
    endpoint: "https://httpbin.org/json"
    validation:
      status: 200
      headers:
        present:
          - "Content-Type"
          - "Content-Length"
        contains:
          Content-Type: "json"
        matches:
          Content-Length: "^[0-9]+$"
      body:
        # Nested path validation
        present:
          - "slideshow"
          - "slideshow.author"
          - "slideshow.date"
          - "slideshow.slides"
          - "slideshow.slides[0]"
          - "slideshow.slides[0].title"
          - "slideshow.slides[0].type"
        # Type checking on nested fields
        type:
          slideshow.author: string
          slideshow.date: string
          slideshow.slides: array
          slideshow.title: string
        # Exact value matching
        equals:
          slideshow.title: "Sample Slide Show"
          slideshow.author: "Yours Truly"
          slideshow.date: "date of publication"
        # Security check - ensure no sensitive data
        absent:
          - "password"
          - "api_key"
          - "secret"
  
  # Test 2: POST with complex body and validation
  - name: "Complex POST Validation"
    type: rest
    endpoint: "https://httpbin.org/post"
    method: POST
    headers:
      Content-Type: "application/json"
      X-Request-ID: "test-12345"
    body:
      user:
        name: "John Doe"
        email: "john@example.com"
        age: 30
        active: true
        tags: ["premium", "verified"]
        metadata:
          signup_date: "2024-01-01"
          referral_code: "ABC123"
    validation:
      status: 200
      headers:
        present:
          - "Content-Type"
        # Ensure echo header is returned
        equals:
          Content-Type: "application/json"
      body:
        # Verify request was echoed correctly
        present:
          - "json"
          - "json.user"
          - "json.user.name"
          - "json.user.email"
          - "json.user.age"
          - "json.user.active"
          - "json.user.tags"
          - "json.user.metadata"
        # Type validation
        type:
          json.user.name: string
          json.user.email: string
          json.user.age: integer
          json.user.active: boolean
          json.user.tags: array
          json.user.metadata: object
        # Value validation
        equals:
          json.user.name: "John Doe"
          json.user.age: 30
          json.user.active: true
        # Regex pattern validation
        matches:
          json.user.email: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          json.user.metadata.referral_code: "^[A-Z]{3}[0-9]{3}$"
        # Array element validation
        contains:
          json.user.tags: "premium"
        # Range validation
        range:
          json.user.age: [18, 100]
    output:
      USER_NAME: "body.json.user.name"
      USER_EMAIL: "body.json.user.email"
  
  # Test 3: UUID and pattern matching
  - name: "UUID and Pattern Validation"
    type: rest
    endpoint: "https://httpbin.org/uuid"
    validation:
      status: 200
      body:
        present:
          - "uuid"
        type:
          uuid: string
        # Strict UUID v4 pattern
        matches:
          uuid: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
  
  # Test 4: Headers validation with patterns
  - name: "Complex Headers Validation"
    type: rest
    endpoint: "https://httpbin.org/response-headers"
    headers:
      X-Custom-Header: "test-value"
    validation:
      status: 200
      headers:
        present:
          - "Content-Type"
          - "Content-Length"
        # Security headers should be absent
        absent:
          - "X-Debug-Token"
          - "X-Internal-IP"
        contains:
          Content-Type: "application/json"
  
  # Test 5: Multiple validations on same response
  - name: "Multi-Layer Validation"
    type: rest
    endpoint: "https://httpbin.org/get"
    validation:
      status: 200
      headers:
        present: ["Content-Type"]
        contains:
          Content-Type: "json"
        matches:
          Content-Type: "application/json.*"
      body:
        present:
          - "args"
          - "headers"
          - "origin"
          - "url"
        type:
          args: object
          headers: object
          origin: string
          url: string
        # IP address pattern
        matches:
          origin: "^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$"
        # URL pattern
        matches:
          url: "^https://httpbin\\.org/get$"
  
  # Test 6: Type validation across different types
  - name: "Type System Validation"
    type: rest
    endpoint: "https://httpbin.org/post"
    method: POST
    headers:
      Content-Type: "application/json"
    body:
      string_field: "text"
      integer_field: 42
      number_field: 3.14
      boolean_field: true
      array_field: [1, 2, 3]
      object_field:
        nested: "value"
      null_field: null
    validation:
      status: 200
      body:
        type:
          json.string_field: string
          json.integer_field: integer
          json.number_field: number
          json.boolean_field: boolean
          json.array_field: array
          json.object_field: object
          json.null_field: "null"  # IMPORTANT: Quote "null" to pass as string, not Python None
  
  # Test 7: Range validation with bounds
  - name: "Numeric Range Validation"
    type: rest
    endpoint: "https://httpbin.org/post"
    method: POST
    headers:
      Content-Type: "application/json"
    body:
      age: 25
      temperature: 72.5
      score: 95
      count: 1000
    validation:
      status: 200
      body:
        range:
          json.age: [0, 120]           # 0 <= age <= 120
          json.temperature: [32, 212]  # Fahrenheit range
          json.score: [0, 100]         # Percentage
          json.count: [1, null]        # At least 1, no upper limit
  
  # Test 8: Security validation - ensure sensitive data absent
  - name: "Security Validation"
    type: rest
    endpoint: "https://httpbin.org/get"
    validation:
      status: 200
      headers:
        # These headers should never be present
        absent:
          - "X-API-Key"
          - "Authorization"
          - "X-Internal-Token"
          - "X-Debug-Info"
      body:
        # These fields should never be in response
        absent:
          - "password"
          - "secret_key"
          - "api_token"
          - "private_key"
          - "session_id"
